<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>📖 使用帮助 - 量化交易系统</title>
    <script>
        (function () {
            try {
                const raw = localStorage.getItem('quant_ui_state_v1') || localStorage.getItem('quant_theme');
                if (!raw) return;
                if (raw === 'light' || raw === 'dark') {
                    document.documentElement.setAttribute('data-theme', raw);
                    return;
                }
                const state = JSON.parse(raw);
                const theme = state && (state.theme || state.appearance);
                if (theme === 'light' || theme === 'dark') {
                    document.documentElement.setAttribute('data-theme', theme);
                }
            } catch (e) {
            }
        })();
    </script>
    <style>
        html {
            font-size: 14px;
        }

        html[data-theme="dark"], :root {
            --font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            --radius: 12px;
            --app-bg: linear-gradient(135deg, #0c1929 0%, #141a2d 50%, #111c33 100%);
            --surface: rgba(17, 24, 39, 0.75);
            --surface-2: rgba(20, 28, 45, 0.72);
            --border: rgba(102, 126, 234, 0.28);
            --text: rgba(255, 255, 255, 0.92);
            --text-muted: rgba(255, 255, 255, 0.68);
            --accent: #8aa1ff;
            --accent-2: #667eea;
            --shadow: 0 10px 30px rgba(0,0,0,0.35);
        }

        html[data-theme="light"] {
            --font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            --radius: 12px;
            --app-bg: linear-gradient(135deg, #f6f8ff 0%, #f3f6ff 50%, #eef3ff 100%);
            --surface: rgba(255, 255, 255, 0.92);
            --surface-2: rgba(255, 255, 255, 0.75);
            --border: rgba(15, 23, 42, 0.12);
            --text: rgba(15, 23, 42, 0.92);
            --text-muted: rgba(15, 23, 42, 0.82);
            --accent: #2563eb;
            --accent-2: #7c3aed;
            --shadow: 0 10px 30px rgba(15, 23, 42, 0.10);
        }

        html[data-theme="dark"] { color-scheme: dark; }
        html[data-theme="light"] { color-scheme: light; }

        body {
            margin: 0;
            font-family: var(--font-family);
            background: var(--app-bg);
            color: var(--text);
        }

        .wrap {
            max-width: 980px;
            margin: 0 auto;
            padding: 22px 16px 80px;
        }

        .header {
            background: linear-gradient(90deg, var(--accent) 0%, var(--accent-2) 55%, #ec4899 100%);
            border-radius: var(--radius);
            padding: 16px 18px;
            box-shadow: var(--shadow);
        }

        .title {
            font-size: 20px;
            font-weight: 800;
            margin: 0 0 6px 0;
            color: #fff;
            text-shadow: 0 2px 8px rgba(0,0,0,0.25);
        }

        .subtitle {
            margin: 0;
            color: rgba(255,255,255,0.92);
            font-size: 12px;
        }

        .grid {
            display: grid;
            grid-template-columns: 260px 1fr;
            gap: 14px;
            margin-top: 14px;
        }

        @media (max-width: 900px) {
            .grid { grid-template-columns: 1fr; }
        }

        .nav, .card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .nav {
            padding: 12px 12px;
            position: sticky;
            top: 12px;
            height: fit-content;
        }

        .nav h3 {
            margin: 0 0 10px 0;
            font-size: 13px;
            color: var(--text-muted);
            letter-spacing: 0.2px;
        }

        .nav a {
            display: block;
            padding: 8px 10px;
            border-radius: 10px;
            text-decoration: none;
            color: var(--text);
            border: 1px solid transparent;
        }

        .nav a:hover {
            border-color: var(--border);
            background: var(--surface-2);
        }

        .card {
            padding: 14px 16px;
        }

        h2 {
            margin: 0 0 10px 0;
            font-size: 16px;
            color: var(--accent-2);
        }

        h3 {
            margin: 14px 0 8px 0;
            font-size: 14px;
            color: var(--accent);
        }

        p {
            margin: 8px 0;
            color: var(--text);
            line-height: 1.7;
        }

        ul {
            margin: 8px 0 12px 18px;
            color: var(--text);
            line-height: 1.7;
        }

        .note {
            margin: 10px 0;
            padding: 10px 12px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: var(--surface-2);
            color: var(--text-muted);
        }

        .kbd {
            display: inline-block;
            padding: 1px 6px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--surface-2);
            font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
            font-size: 12px;
            color: var(--text);
        }

        .link {
            color: var(--accent-2);
            text-decoration: none;
        }

        .link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="wrap">
        <div class="header">
            <h1 class="title">📖 使用帮助</h1>
            <p class="subtitle">覆盖：数据获取、策略对比、筛选、股池、详细分析、参数优化、外观主题、常见问题</p>
        </div>

        <div class="grid">
            <div class="nav">
                <h3>目录</h3>
                <a href="#quickstart">快速开始</a>
                <a href="#tabs">界面结构</a>
                <a href="#data">数据与缓存</a>
                <a href="#comparison">策略对比</a>
                <a href="#strategies">策略说明</a>
                <a href="#details">详细分析</a>
                <a href="#screening">股票筛选</a>
                <a href="#pool">股票池</a>
                <a href="#optimization">参数优化</a>
                <a href="#appearance">外观主题</a>
                <a href="#faq">常见问题</a>
            </div>

            <div class="card">
                <section id="quickstart">
                    <h2>快速开始</h2>
                    <ul>
                        <li>启动后端服务：运行 quant_server.py，浏览器访问 <span class="kbd">http://localhost:5000</span>。</li>
                        <li>设置回测参数：左侧输入股票代码、初始资金、开始/结束日期。</li>
                        <li>选择策略：在“策略选择（多选对比）”中勾选一个或多个策略。</li>
                        <li>获取数据并运行：进入“对比”或“详细分析”，点击相应按钮获取数据、运行回测。</li>
                        <li>筛选与入池：进入“筛选”，选择范围与策略进行筛选；勾选结果后手动加入股池。</li>
                    </ul>
                    <div class="note">提示：系统会自动保存常用设置（外观、筛选条件、策略勾选、股票/日期等），下次打开无需重复设置。</div>
                </section>

                <section id="tabs">
                    <h2>界面结构</h2>
                    <p>主界面通常包含 4 个核心区域：</p>
                    <ul>
                        <li>左侧：连接状态、回测设置、外观切换、帮助入口。</li>
                        <li>顶部：系统标题、时间与数据来源提示。</li>
                        <li>中间/右侧：标签页（对比/筛选/详细/股池/优化等）。</li>
                        <li>弹出层：加载进度、提示信息、下拉选择（行业等）。</li>
                    </ul>
                </section>

                <section id="data">
                    <h2>数据与缓存</h2>
                    <h3>数据来源</h3>
                    <ul>
                        <li>优先使用本地缓存数据，提高速度。</li>
                        <li>后端可从 Tushare 获取真实行情；若网络或权限不足，可能回退到模拟数据（视实现而定）。</li>
                    </ul>
                    <h3>缓存机制</h3>
                    <ul>
                        <li>前端会缓存已请求的时间区间数据，重复回测无需再次下载。</li>
                        <li>前端会保存“上次会话”的股票与日期，以便快速恢复。</li>
                        <li>股池会持久化保存（用于跨会话继续跟踪）。</li>
                    </ul>
                </section>

                <section id="comparison">
                    <h2>策略对比</h2>
                    <p>用于同一支股票、同一时间区间内，多策略横向比较。</p>
                    <ul>
                        <li>选择多个策略后运行，对比表会展示收益、回撤、胜率、交易次数等指标。</li>
                        <li>图表区域会展示权益曲线、收益分布、K线等可视化。</li>
                        <li>若你修改了参数，系统会重新计算并刷新对比结果。</li>
                    </ul>
                </section>

                <section id="strategies">
                    <h2>策略说明</h2>
                    <p>系统内置12种量化交易策略，涵盖技术分析、机器学习等多种类型。</p>
                    
                    <h3>🤖 深度融合策略</h3>
                    <ul>
                        <li>融合多技术指标，通过加权评分+确认信号机制决策</li>
                        <li>支持自适应参数调整，根据市场状态动态优化</li>
                        <li>核心指标：MA对齐确认、MACD动量、RSI超卖、成交量确认、布林带位置、ADX趋势强度</li>
                    </ul>
                    
                    <h3>⚡ 量价突破策略</h3>
                    <ul>
                        <li>多维度突破确认：价格突破+成交量放大+趋势对齐+波动率过滤</li>
                        <li>适合趋势启动阶段，捕捉主升浪机会</li>
                        <li>核心指标：价格突破、成交量激增、趋势确认、波动率过滤、动能确认</li>
                    </ul>
                    
                    <h3>💎 超跌反弹策略</h3>
                    <ul>
                        <li>多维度超卖确认+反弹信号检测</li>
                        <li>结合RSI背离、MACD背离、K线形态识别底部</li>
                        <li>适合震荡市和下跌后的反弹机会</li>
                    </ul>
                    
                    <h3>📈 趋势增强策略</h3>
                    <ul>
                        <li>多时间框架趋势确认：均线排列+ADX强度+成交量趋势+动量确认</li>
                        <li>顺势而为，在趋势明确时入场</li>
                        <li>适合趋势明显的市场环境</li>
                    </ul>
                    
                    <h3>🎯 MACD背离策略</h3>
                    <ul>
                        <li>多周期背离检测：价格-MACD背离+成交量背离+RSI背离</li>
                        <li>K线形态确认提高信号可靠性</li>
                        <li>适合捕捉趋势转折点的交易机会</li>
                    </ul>
                    
                    <h3>📊 布林极限策略</h3>
                    <ul>
                        <li>布林带极值交易+反转确认</li>
                        <li>下轨触及+RSI超卖+成交量地量+K线形态</li>
                        <li>适合区间波动和均值回归交易</li>
                    </ul>
                    
                    <h3>⚡ 动量轮动策略</h3>
                    <ul>
                        <li>多周期动量确认+相对强度分析</li>
                        <li>短中长期动量+动量质量+波动率匹配</li>
                        <li>适合强势股跟踪和板块轮动</li>
                    </ul>
                    
                    <h3>🐢 海龟增强策略</h3>
                    <ul>
                        <li>多时间框架突破+风险管理增强</li>
                        <li>突破确认+趋势过滤+假突破过滤+风险评分</li>
                        <li>经典海龟交易法则的改进版本</li>
                    </ul>
                    
                    <h3>🧩 筹码突破策略</h3>
                    <ul>
                        <li>筹码单峰低位+放量突破</li>
                        <li>通过筹码分布识别低位集中区域，配合放量突破信号</li>
                        <li>适合主力资金介入后的启动阶段</li>
                    </ul>
                    
                    <h3>🚀 XGBoost机器学习策略</h3>
                    <ul>
                        <li>XGBoost梯度提升预测+条件确认</li>
                        <li>用历史数据训练XGBoost模型，概率过滤+多重确认</li>
                        <li>基于机器学习的智能选股策略</li>
                    </ul>
                    
                    <h3>🧠 LSTM深度学习策略</h3>
                    <ul>
                        <li>LSTM时间序列预测+条件确认</li>
                        <li>用历史数据训练LSTM模型，捕捉时间序列模式</li>
                        <li>深度学习捕捉股价的时序规律</li>
                    </ul>
                    
                    <h3>🎭 混合机器学习策略</h3>
                    <ul>
                        <li>XGBoost+LSTM混合预测</li>
                        <li>结合梯度提升和时间序列模型的优势</li>
                        <li>多模型融合提高预测稳定性和准确性</li>
                    </ul>
                    
                    <h3>🔀 Stacking集成策略</h3>
                    <ul>
                        <li>多层模型集成学习：将多个基学习器的预测结果作为输入，训练元学习器进行最终预测</li>
                        <li>综合趋势、成交量、ML指标、动量等多维度评分</li>
                        <li>适合捕捉复杂市场模式，预期收益50-110%</li>
                    </ul>
                    
                    <h3>🌌 CNN-LSTM-Transformer策略</h3>
                    <ul>
                        <li>融合三种深度学习架构：CNN提取局部特征、LSTM捕捉时序模式、Transformer处理长程依赖</li>
                        <li>多维度评分系统：CNN评分（KDJ+量价）、LSTM评分（趋势+RSI）、Transformer评分（价格变化+布林带）</li>
                        <li>适合处理复杂时间序列数据，预期收益60-130%</li>
                    </ul>
                    
                    <div class="note">提示：不同策略适用于不同市场环境，建议多策略对比后选择最适合当前市场的策略。机器学习策略需要足够的训练数据，建议在数据量充足的情况下使用。</div>
                </section>

                <section id="details">
                    <h2>详细分析</h2>
                    <p>用于深入查看某个策略在当前股票上的信号、交易过程与图表细节。</p>
                    <h3>K线图功能</h3>
                    <ul>
                        <li><strong>多周期切换</strong>：支持日线(D)、周线(W)、月线(M)切换查看。</li>
                        <li><strong>买卖信号</strong>：K线图上用红色箭头(B)标记买入点，绿色箭头(S)标记卖出点。</li>
                        <li><strong>均线指标</strong>：显示MA5、MA10、MA20、MA30四条移动平均线。</li>
                        <li><strong>成交量</strong>：下方柱状图显示成交量，红涨绿跌。</li>
                        <li><strong>缩放滑块</strong>：底部滑块可缩放查看不同时间区间。</li>
                        <li><strong>十字光标</strong>：鼠标悬停显示详细数据（开盘价、最高价、最低价、收盘价、涨跌幅等）。</li>
                    </ul>
                    <h3>筹码分布</h3>
                    <ul>
                        <li>右侧显示筹码分布热力图，反映不同价格区间的持仓量。</li>
                        <li>鼠标在K线图上移动时，筹码图会同步更新显示对应日期的分布。</li>
                    </ul>
                    <h3>交易记录</h3>
                    <ul>
                        <li>显示该策略在当前股票上的所有买卖交易记录。</li>
                        <li>包含交易日期、类型、价格、数量、盈亏等信息。</li>
                    </ul>
                </section>

                <section id="screening">
                    <h2>股票筛选</h2>
                    <p>用于在一个股票范围内批量寻找满足策略信号的股票。</p>
                    <h3>操作流程</h3>
                    <ul>
                        <li>选择筛选范围：如 A 股全范围、沪市、深市、创业板、指数成分、自选列表等。</li>
                        <li>选择筛选策略：可以多选，系统会找出同时满足多个策略信号的股票。</li>
                        <li>可选过滤：智能验证、行业过滤、概念过滤等。</li>
                        <li>点击开始筛选：结果表支持排序、查看详情、手动加入股池。</li>
                    </ul>
                    <h3>筛选结果解读</h3>
                    <ul>
                        <li><strong>综合评分</strong>：基于历史回测表现计算的信号质量评分。</li>
                        <li><strong>历史收益</strong>：该策略在历史相似信号下的平均收益率。</li>
                        <li><strong>信号强度</strong>：当前信号的强度值（0-100）。</li>
                        <li><strong>最新信号</strong>：显示买入日期和价格。</li>
                    </ul>
                    <div class="note">注意：筛选结果不会自动加入股池，需要勾选后手动加入，避免误入池。</div>
                </section>

                <section id="pool">
                    <h2>股票池</h2>
                    <p>用于集中管理"值得继续跟踪"的股票（来源可能是筛选、手动添加、策略信号等）。</p>
                    <h3>核心功能</h3>
                    <ul>
                        <li><strong>自选加入</strong>：在"详细分析"页面点击"⭐ 自选加入"将当前股票加入股池。</li>
                        <li><strong>筛选入池</strong>：在"筛选"页面勾选股票后，点击"加入股票池"批量添加。</li>
                        <li><strong>刷新收益</strong>：点击"🔄 刷新收益"获取最新行情数据，计算实时收益率。</li>
                        <li><strong>排序功能</strong>：点击"至今收益"表头可按收益率排序（高收益/低收益）。</li>
                        <li><strong>批量操作</strong>：勾选股票后可批量删除或清空股池。</li>
                    </ul>
                    <h3>数据展示</h3>
                    <ul>
                        <li>显示策略名称、股票代码、股票名称、市盈率、市净率。</li>
                        <li>显示入选时间、入选价格、最新价格、至今收益。</li>
                        <li>股池数据持久化保存，重开依然存在。</li>
                    </ul>
                    <div class="note">提示：股池最多显示15行，超出部分可滚动查看。收益率红色表示盈利，绿色表示亏损。</div>
                </section>

                <section id="optimization">
                    <h2>参数优化</h2>
                    <p>用于对策略参数进行自动化寻优（通常基于历史回测表现）。</p>
                    <h3>优化流程</h3>
                    <ul>
                        <li><strong>准备数据</strong>：先获取股票数据（股票代码+日期范围）。</li>
                        <li><strong>选择策略</strong>：在"详细分析"页面选择要优化的策略。</li>
                        <li><strong>运行优化</strong>：点击"开始优化"，系统会自动遍历参数组合寻找最优解。</li>
                        <li><strong>查看进度</strong>：实时显示优化进度、当前最佳收益、预计剩余时间。</li>
                        <li><strong>应用结果</strong>：优化完成后可一键应用优化参数，并保存到本地。</li>
                    </ul>
                    <h3>参数微调</h3>
                    <ul>
                        <li>优化完成后，可在参数区拖动滑块手动微调。</li>
                        <li>系统会自动保存并实时刷新回测结果。</li>
                        <li>支持敏感性分析和热力图展示参数影响。</li>
                    </ul>
                    <div class="note">提示：参数优化基于历史数据，过去表现不代表未来收益，请谨慎使用。</div>
                </section>

                <section id="appearance">
                    <h2>外观主题</h2>
                    <ul>
                        <li>左侧“外观”支持亮色/暗色切换，立即生效。</li>
                        <li>外观会自动保存，下次打开自动恢复。</li>
                        <li>若你觉得亮色下对比度仍不足，可反馈具体区域（如表格提示、图表浮层），可以继续精细化优化。</li>
                    </ul>
                </section>

                <section id="faq">
                    <h2>常见问题</h2>
                    <h3>1) 看不到数据/连接失败</h3>
                    <ul>
                        <li>确认后端服务已启动，且浏览器能访问 <span class="kbd">http://localhost:5000</span>。</li>
                        <li>检查终端日志是否有 Token 或网络错误提示。</li>
                        <li>确认 Tushare Token 已正确配置（环境变量或 token 文件）。</li>
                    </ul>
                    <h3>2) 筛选很慢</h3>
                    <ul>
                        <li>全市场筛选计算量大，建议先缩小范围（沪市/深市/创业板/指数成分）。</li>
                        <li>优先使用缓存区间，避免重复拉取数据。</li>
                        <li>减少同时筛选的策略数量。</li>
                    </ul>
                    <h3>3) 股票池收益不更新</h3>
                    <ul>
                        <li>点击"🔄 刷新收益"按钮获取最新行情数据。</li>
                        <li>确认后端服务正常运行且网络连接正常。</li>
                        <li>若仍不更新，尝试刷新页面后重新获取。</li>
                    </ul>
                    <h3>4) 设置没有保存</h3>
                    <ul>
                        <li>系统基于浏览器本地存储保存设置；若使用无痕模式或禁用存储，可能无法持久化。</li>
                        <li>也可尝试刷新页面后再检查。</li>
                    </ul>
                    <h3>5) K线图显示异常</h3>
                    <ul>
                        <li>确认已获取数据（股票代码和日期范围正确）。</li>
                        <li>尝试切换周期（日线/周线/月线）后切回。</li>
                        <li>使用底部滑块调整显示的时间范围。</li>
                    </ul>
                    <h3>6) 策略信号不准确</h3>
                    <ul>
                        <li>不同策略适用于不同市场环境，建议多策略对比。</li>
                        <li>使用参数优化功能寻找最佳参数组合。</li>
                        <li>结合筛选功能验证策略在历史数据上的表现。</li>
                    </ul>
                    <div class="note">需要更多帮助：可以回到主页面，或将具体问题截图发出，便于快速定位。</div>
                    <p><a class="link" href="quant_frontend.html" target="_blank">返回主页面</a></p>
                </section>
            </div>
        </div>
    </div>
</body>
</html>
